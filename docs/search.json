[
  {
    "objectID": "sazonalidade.html#padrão-sazonal",
    "href": "sazonalidade.html#padrão-sazonal",
    "title": "7  Sazonalidade",
    "section": "7.1 Padrão sazonal",
    "text": "7.1 Padrão sazonal\nPadrões que surgem sistematicamente ao longo do tempo são denominados sazonais. Exemplos: flutuações de temperatura entre estações, início e fim do semestre letivo, Natal, dias úteis, feriados flutuantes como a Páscoa e o Carnaval.\nUm padrão sazonal pode ser modelado através de uma função periódica.\n\nDefinition 7.1 Dizemos que \\(s(.)\\) é uma função periódica de período \\(p\\) se \\[s(t)=s(t + kp),\\;\\forall k=1,2,\\ldots.\\]\n\n\nExample 7.1 A função \\[s(t)=\\left\\{ \\begin{align}\n-1, &\\;\\;t=1,4,7,\\ldots\\\\\n0, &\\;\\; t=2,5,8,\\ldots\\\\\n1,&\\;\\;t=3,6,9,\\ldots\n\\end{align}\n\\right.\n\\] é periódica e possui período \\(p=3\\).\n\n\nExample 7.2 A função \\[s(t)=\\cos\\left(2\\pi\\frac{t}{4}\\right)\\] é periódica (com \\(p=4\\)). De fato, para \\(k=1,2,3,\\ldots,\\) \\[\\begin{align*}\n    g(t+4k) &= \\cos\\left(2\\pi\\frac{t+4k}{4}\\right)=\\cos\\left( \\pi\\frac{t}{4}+2\\pi k\\right)\\\\\n    &=\\cos\\left( 2\\pi\\frac{t}{4}\\right)\\underbrace{\\cos\\left(2\\pi k\\right)}_\\text{1} - \\sin\\left( \\pi\\frac{t}{4}\\right)\\underbrace{\\sin\\left(2\\pi k\\right)}_\\text{0}\\\\\n    &=\\cos\\left(2\\pi\\frac{t}{4}\\right) = g(t).  \n\\end{align*}\\]\n\nSeja \\(s(.)\\) uma função periódica. Então, uma série temporal sazonal aditiva é descrita como\n\\[x_t=s(t)+\\varepsilon_t,\\] onde \\(\\varepsilon_t\\) é um ruído estacionário.\n\nAtenção. Ao criar um objeto do tipo ts no R, o argumento frequency é considerado o período do padrão sazonal. A maioria das funções voltadas para padrões sazonais acessam essa informação no objeto."
  },
  {
    "objectID": "sazonalidade.html#gráficos-sazonal-de-subséries",
    "href": "sazonalidade.html#gráficos-sazonal-de-subséries",
    "title": "7  Sazonalidade",
    "section": "7.2 Gráficos sazonal de subséries",
    "text": "7.2 Gráficos sazonal de subséries\nSeja \\(x_t\\) uma série sazonal de período \\(p\\). Para construir um gráfico sazonal de subséries:\n\nFaça \\(p\\) subséries: \\[\\begin{align*}\n      &x_1,x_{1+p},x_{1+2p},\\ldots \\\\\n      &x_{2},x_{2+p},x_{2+2p},\\ldots\\\\\n      &\\cdots\\\\\n      &x_{p},x_{2p},x_{3p},\\ldots\\\\       \n      \\end{align*}\\]\nCalcule a média de cada subsérie.\nFaça um gráfico de cada subsérie, cada um com uma linha horizontal com o valor de sua respectiva média.\n\n\nObserve que, para um padrão sazonal, a subsérie \\[x_{i},x_{i+p},x_{i+2p},\\ldots\\] é equivalente à \\[s(i)+\\varepsilon_i,s(i)+\\varepsilon_{i+p},s(i)+\\varepsilon_{i+2p},\\ldots\\] e, supondo que \\(\\varepsilon_t\\) é um ruído granco ergódico, teremos que \\[\\hat{s}(i)=\\frac{1}{m+1}\\sum_{j=0}^m x_{i+jp}\\] onde \\(m+1\\) é o tamanho da amostra correspodente à subsérie.\n\nNo R, o comando monthplot(x) faz o gráfico de subséries. Considerando um padrão sazonal, cada subsérie deve oscilar em torno de uma média constante. Vejamos algus exemplos.\n\nExample 7.3 A série abaixo (gráfico à esquerda) apresenta as temperaturas médias mensais, em Fahrenheits, no Castelo de Nottingham entre 1920 e 1939. O gráfico à direita apresenta o gráfico de subséries. Como a série possui período 12, este último gráfico já identifica cada subsérie com a inicial do mês correspondente. Note que a maioria das subséries oscila em torno da média\n\nts.plot(nottem)\nmonthplot(nottem)\n\n\n\n\n\n\nFigure 7.1: Gráfico da série de temperaturas no Castelo de Nottingham\n\n\n\n\n\n\n\nFigure 7.2: Gráfico de subséries\n\n\n\n\n\n\n\\(\\blacksquare\\)\n\nÉ possível que a tendência construa uma falta impressão sobre o comportamento sazonal. Portanto, é interessante remover a tendência da série antes de fazer o gráfico das subséries.\n\nExample 7.4 Abaixo apresentamos a série mensal da concentração de CO\\(_2\\), em partes por milhão, no Mauna Loa. Observe a clara tendência de crescimento e o padrão sazonal.\n\nts.plot(co2)\n\n\n\n\nO gráfico das subséries é dado abaixo. Observe que há uma tendência crescente em cada subsérie.\n\nmonthplot(co2)\n\n\n\n\nA tendência crescente nas subséries não nos nos permitiria trabalhar com uma função periódica. Contudo o gráfico está sendo influenciado pela tendência. Vamos removê-la e fazer o gráfico novamente.\n\n# estimação da tendência via loess\ntempo &lt;- 1 : length(co2)\nmodel &lt;- loess( co2 ~tempo)\ntend &lt;- fitted(model)\n\n# série sem tendência e o gráfico de subséries\nplot( co2-tend)\n\n\n\nmonthplot(co2-tend)\n\n\n\n\n\\(\\blacksquare\\)\n\nTambém é possível que o padrão sazonal não seja bem representado por uma função periódica. Isto ocorre quando o gráfico de subséries possui tendência.\n\nExample 7.5 A ?fig-AirPassengersMonthplot apresenta o gráfico da série AirPassengers e de suas subséries. Observe que todas as subséries possuem um padrão de crescimento, que deve estar sendo governado pela tendência crescente da série.\n\nts.plot(AirPassengers)\nmonthplot(AirPassengers)\n\n\n\n\n\n\nFigure 7.3: Gráfico da série AirPassengers\n\n\n\n\n\n\n\nFigure 7.4: Gráfico de subséries da série AirPassengers. Observe as tendências monótona crescente em cada subgráfico\n\n\n\n\n\n\nAbaixo, vamos estimar a tendência da série e removê-la. Note que o padrão das subséries se altera, mostrando o real comportamento do padrão sazonal: é uma tendência de crescimento nos meses de verão americano (junho, julho e agosto) e um padrão de queda começando em novembro e pegando so três subsequentes meses do inverno.\n\n# estimação da tendência via loess\ntempo &lt;- 1 : length(AirPassengers)\nmodel &lt;- loess( AirPassengers ~tempo)\ntend &lt;- fitted(model)\n\n# série sem tendência e o gráfico de subséries\nplot( AirPassengers-tend)\n\n\n\nmonthplot(AirPassengers-tend)\n\n\n\n\n\\(\\blacksquare\\)"
  },
  {
    "objectID": "sazonalidade.html#dessazonalização",
    "href": "sazonalidade.html#dessazonalização",
    "title": "7  Sazonalidade",
    "section": "7.3 Dessazonalização",
    "text": "7.3 Dessazonalização\nExistem séries que apresentam tanto tendência quanto sazonalidade. Isso pode dificultar o estudo da tendência, uma vez que a sazonalidade interfere no movimento de subida e descida da série. Nesses casos, é interessante obter uma estimativa da parte sazonal para removê-la da série.\nConsidere a série \\[y_t = T^\\star(t)+s^\\star(t)+\\varepsilon_t,\\] onde \\(T^\\star(t)\\) é a tendência e \\(s^\\star(t)\\) uma função periódica, com período igual a \\(p\\). É sempre verdade que existe uma constante real \\(c\\) tal que \\[\\sum_{j=1}^p s^\\star(t+j)=c\\] para qualquer \\(t=0,1,\\ldots\\). Contudo, note que \\(c\\) é uma constante (que, por sua vez, faz parte da tendência da série). Fazendo \\(T(t)=T^\\star(t)+c\\) e \\(s(t)=s^\\star(t)-c\\), teremos \\[y_t = T^\\star(t)+c + s^\\star(t)-c+\\varepsilon_t=T(t)+ s(t)+\\varepsilon_t,\\]\ne sempre podemos assumir que \\[\\sum_{t=1}^{p}s(t)=0.\\] Isto é equivalente a afirmar que o efeito sazonal desaparece quando as \\(p\\) observações são agregadas. Deste modo, o estimador para tendência \\(p\\)-MM estima a tendência sem o efeito sazonal.\n\nConsidere novamente a série com o número de óbitos por doenças pulmonares no Reino Unido. A figura abaixo mostra a série original e a tendência, estimada pela 12-MM. Observe o padrão claro de tendência decrescente."
  },
  {
    "objectID": "sazonalidade.html#decomposições-de-séries",
    "href": "sazonalidade.html#decomposições-de-séries",
    "title": "7  Sazonalidade",
    "section": "7.4 Decomposições de séries",
    "text": "7.4 Decomposições de séries\nEm geral, assume-se que a série temporal admite a seguinte decomposição: \\[x_t=T(t)+s(t)+\\varepsilon_t\\]\nA estimação não paramétrica dos componentes da decomposição constitui-se de ferramenta exploratória essencial para a análise de séries temporais. A decomposição clássica é realizada através dos seguintes passos:\n\nEstime a tendência dessazoanlizada, utilizando a \\(p\\)-MM, obtendo \\(\\hat{T}\\)\nRemova a tendência da série: \\(\\tilde{x}_t=x_t-\\hat{T}\\)\nEncontre as \\(p\\) subséries de \\(\\tilde{x}\\) e estime os valores de \\(s\\) através de suas médias.\nEstime os resíduos: \\(\\hat{\\varepsilon}_t=x_t-\\hat{T}(t)-\\hat{s}(t)\\) A Figure 7.5 apresenta a decomposição clássica da série de óbitos pode doenças pulmonares no Reino Unido.\n\n\nplot(decompose(ldeaths))\n\n\n\n\n\n\nFigure 7.5: Decomposição da série de óbitos por doenças pulmonares no Reino Unido\n\n\n\n\n\n\nComo é utilizada uma média móvel, a estimativa da tendência e do ruído é prejudicada no início e fim da série. Outro problema que este método não consegue estimar padrões sazonais que não sejam representamos por uma função periódica. Para ilustrar, apresentamos abaixo a decomposição clássica da série AirPassengers. Como a estimação da parte sazonal utilizou a média das subséries, as tendências sazonais vistas no Example 7.5 foram para os resíduos (identificados co)\n\nplot(decompose(AirPassengers))\n\n\n\n\nUma solução mais robusta é conhecida como STL, que realiza uma séries de estimativas de tendência, tanto para a geral quanto para a sazonal, utilizando o loess. Os detalhes podem ser vistos no paper original STL Abaixo, apresentamos o STL para a série AirPassengers. Observe que a sazonalidade foi melhor estimada, embora ainda exista um padrão sazonal nos resíduos.\n\n# além da série, devemos colocar o período desejado na função \nplot(stl(AirPassengers, 12))"
  },
  {
    "objectID": "sazonalidade.html#modelo-de-forma-livre---ou-fatores-sazonais",
    "href": "sazonalidade.html#modelo-de-forma-livre---ou-fatores-sazonais",
    "title": "7  Sazonalidade",
    "section": "7.5 Modelo de Forma livre - ou fatores sazonais",
    "text": "7.5 Modelo de Forma livre - ou fatores sazonais\nConsidere uma série temporal com sazonalidade dada por uma função periódica \\(s(.)\\) de período \\(p\\). Sejam \\[\\beta_j=s(t+jp).\\] Os parâmetros \\(\\beta_1,\\ldots,\\beta_p\\) são denominados fatores sazonais. Note que é necessário colocar a restrição \\[\\beta_p = -\\beta_1-\\cdots -\\beta_{p-1},\\] pois \\[\\sum_{j=1}^p\\beta_j=0\\] (ou seja, existem na prática \\(p-1\\) fatores sazonais para serem estimados).\n\nExample 7.6 Seja \\(x_t\\) uma série sazonal de período \\(p=4\\) (por, exemplo, em dados trimestrais). Então \\[\\begin{align*}\n        E(x_t)&=s(t)=\\beta_1, t=1,5,9 ,\\ldots,\\\\\n        E(x_t)&=s(t)=\\beta_2, t=2,6,10,\\ldots,\\\\\n        E(x_t)&=s(t)=\\beta_3, t=3,7,11,\\ldots,\\\\\n        E(x_t)&=s(t)=-\\beta_1-\\beta_2-\\beta_3, t=4,8,12,\\ldots,\\\\\n        \\end{align*}\\]\n\nSeja \\(\\boldsymbol{E}_{j,m-1}\\) o vetor coluna de comprimento \\(m-1\\) que possui a \\(j\\)-ésima entrada igual a 1 e as demais iguais a zero. Por exemplo \\[\\boldsymbol{E}_{2,3}=\\left(\\begin{array}{c}0 \\\\ 1 \\\\ 0\n\\end{array}\\right).\\] Para um período \\(p\\) e para \\(j=1,\\ldots,p-1\\) faça \\[\\begin{align}\n        \\boldsymbol{f}_{j+kp} = \\boldsymbol{E}_{j,p-1}\n        \\end{align}\\] com \\(k=0,1,2,\\ldots\\). Para \\(s=1,2,\\ldots\\) \\[\\begin{equation}\n        \\boldsymbol{f}_{sp} = -\\textbf{1}_{p-1}\n        \\end{equation}\\]\nEntão, \\[x_t=\\boldsymbol{f}_t' \\boldsymbol{\\beta}+\\varepsilon_t,\\] onde \\(\\boldsymbol{\\beta}'=(\\beta_1,\\ldots,\\beta_{p-1})\\) representa os efeitos sazonais. Disto, teremos \\[\\boldsymbol{x}=\\boldsymbol{F}_n'\\boldsymbol{\\beta}+\\boldsymbol{\\varepsilon}\\] onde a matriz \\(\\boldsymbol{F}_n\\) é formada pelas colunas \\(\\boldsymbol{f}_1,\\ldots,\\boldsymbol{f}_p\\).\nPortanto, a estimação de \\(\\beta\\) é feita através da teoria de modelos lineares.\n\nExample 7.7 Considere novamente a série nottem, representada na figura abaixo.\n\nts.plot(nottem)\nabline(h = mean(nottem))\n\n\n\n\nObserve que a série pode ser vista como uma função periódica com um nível constante (conhecido em regressão como intecepto):\n\\[x_t = \\mu+s(t)+\\varepsilon_t\\]\nConsiderando que os erros são ergódicos, podemos estimar a média \\(\\mu\\) pela média amostral. Deste modo, a série sem tendência é: \\[\\tilde{x}_t=x_t-\\bar{x}=s(t)+\\varepsilon_t\\] Vamos ajustar um modelo linear para \\(\\tilde{x}\\). Para construir a matriz de regressão \\(\\boldsymbol{F}'_n\\) vamos utiliza a função cycle que identifica o índice do padrão sazonal associado a cada observação.\n\nxtil &lt;- nottem - mean(nottem) \nmes &lt;- cycle(nottem)\nmes &lt;- as.factor(mes)\nmod &lt;- lm( xtil ~ mes - 1)\nmod\n\n\nCall:\nlm(formula = xtil ~ mes - 1)\n\nCoefficients:\n   mes1     mes2     mes3     mes4     mes5     mes6     mes7     mes8  \n-9.3446  -9.8496  -6.8446  -2.7496   3.5204   9.0004  12.8604  11.4804  \n   mes9    mes10    mes11    mes12  \n 7.4404   0.4554  -6.4596  -9.5096  \n\n\nNos resultados acima podemos notar que os meses de Novembro até Abril possuem temperaturas menores que a média. O gráfico dos efeitos sazonais é dado a seguir, mostrando que a passagem dos meses possui um padrão de onda, como um cosseno.\n\nplot.new()\nplot.window(xlim = c(0,13), ylim= c(-11,11))\npoints(coefficients(mod), pch = 16)\naxis(1, at = 1:12, labels = c('J','F','M','A','M','J','J','A','S','O','N','D'))\naxis(2)\ntitle(ylab = 'Valor do fator sazonal',xlab='Fator sazonal')\n\n\n\n\nAbaixo analisamos os resíduos do modelo. Os resíduos parecem flutuar e torno de zero com variância constante. O correlograma apresenta algumas leves autocorrelações nas defasagens 1 e 2. O teste de Shapiro-Wilks não rejeita a normalidade, mas o teste de Box-Pierce rejeita a hipótese de ruído branco. Voltaremos a este problema posteriormente.\n\nres &lt;- residuals(mod)\nts.plot(res)\nacf(res)\n\n\n\n\n\n\nGráfico dos ressíduos\n\n\n\n\n\n\n\nCorrelograma dos resíduos\n\n\n\n\n\n\n\nshapiro.test(res)\n\n\n    Shapiro-Wilk normality test\n\ndata:  res\nW = 0.99125, p-value = 0.1612\n\nBox.test(res)\n\n\n    Box-Pierce test\n\ndata:  res\nX-squared = 13.109, df = 1, p-value = 0.0002939\n\n\n\\(\\blacksquare\\)"
  }
]